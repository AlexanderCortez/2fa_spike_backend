(this.webpackJsonp2fa_spike_frontend=this.webpackJsonp2fa_spike_frontend||[]).push([[0],{166:function(e){e.exports=JSON.parse('[{"id":3,"text":"Security","isLabel":true},{"id":4,"text":"Two-step verification","link":""}]')},190:function(e,t,n){e.exports=n(361)},360:function(e,t,n){},361:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=(n(192),n(2)),i=n.n(o),c=n(85),l=n(25),s=n(17),u=n.n(s),p=n(40),d=n(165),m=(n(216),n(19)),f={logged:!1,currentUser:{}},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;return"SIGN_IN_SUCCESSFULL"===n?Object(m.a)(Object(m.a)({},e),{},{currentUser:a}):"SET_LOGGED"===n?Object(m.a)(Object(m.a)({},e),{},{logged:!0}):"SIGN_OUT"===n?f:"DISABLE_TWO_STEP"===n?Object(m.a)(Object(m.a)({},e),{},{currentUser:Object(m.a)(Object(m.a)({},e.currentUser),{},{twoAuthEnabled:!1})}):e},h={qrImage:"",secretKey:"",error:null},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;return"GENERATE_QR_SUCCESS"===n?Object(m.a)(Object(m.a)({},e),{},{error:null,secretKey:a.secret,qrImage:a.qrImage}):"GENERATE_QR_ERROR"===n?Object(m.a)(Object(m.a)({},e),{},{error:a}):"SIGN_OUT"===n?h:e},E=Object(p.combineReducers)({AppReducer:g,TwoStepReducer:v}),S=Object(p.createStore)(E,Object(p.compose)(Object(p.applyMiddleware)(d.a))),b=function(e){e&&(localStorage.setItem("_s",e),u.a.defaults.headers.common.Authorization="Bearer ".concat(e))},y=function(e,t){return{type:e,payload:t}},w=function(e){return function(t){t(y("SIGN_OUT")),localStorage.removeItem("_s"),e.push("/signin")}},O=n(6),j=n(7),T=n(8),x=n(31),_=n(32),k=n(35),I=n(34),L=n(166);function A(){var e=Object(j.a)(["\n  position: fixed;\n  width: 225px;\n  height: 100%;\n  top: 0;\n  left: 0;\n  background-color: #fff;\n  .content {\n    &__logo {\n      height: 60px;\n      display: flex;\n      align-items: center;\n      p {\n        width: 100%;\n        text-align: center;\n        font-size: 22px;\n        color: #172B4D;\n        font-weight: 400;\n      }\n    }\n\n    &__options-wrapper {\n      border-right: 1px solid gray;\n      height: calc(100vh - 60px);\n      &__option {\n        outline: none;\n        cursor: pointer;\n        background: none;\n        width: 100%;\n        padding-left: 25px;\n        display: flex;\n        align-items: center;\n        border-style: none;\n        height: 35px;\n        color: rgb(7, 71, 166);\n        font-size: 14px;\n        font-weight: 400;\n        &:hover {\n          background-color: rgba(7, 71, 166, 0.05);\n        }\n      }\n\n      &__option-label {\n        padding: 20px 5px 10px 15px;\n        color: #707070;\n        font-weight: 500;\n        display: block;\n        font-size: 12px;\n        text-transform: uppercase;\n      }\n    }\n  }\n"]);return A=function(){return e},e}var N=function(e){Object(k.a)(n,e);var t=Object(I.a)(n);function n(){var e;Object(x.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).getActualRoute=function(){},e.renderOption=function(e){var t=e.isLabel,n=e.text,a=e.id;return t?r.a.createElement("span",{key:a,className:"content__options-wrapper__option-label"},n):r.a.createElement("button",{key:a,className:"content__options-wrapper__option",type:"button"},r.a.createElement("span",null,n))},e}return Object(_.a)(n,[{key:"render",value:function(){var e=this;return r.a.createElement(U,null,r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"content__logo"},r.a.createElement("p",null,"Personal Settings")),r.a.createElement("div",{className:"content__options-wrapper"},L.map((function(t){return e.renderOption(t)})))))}}]),n}(a.Component),U=T.a.div(A()),C=n(46);function P(){var e=Object(j.a)(["\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n  padding: 0 20px;\n  height: 50px;\n"]);return P=function(){return e},e}var R=Object(l.b)(null,(function(e){return{signOut:function(t){return e(w(t))}}}))((function(e){var t=e.signOut,n=e.history;return r.a.createElement(q,null,r.a.createElement(C.a,{onClick:function(){return t(n)},type:"primary"},"Sign out"))})),q=T.a.div(P());function D(){var e=Object(j.a)(["\n  padding: 0 30px;\n"]);return D=function(){return e},e}function G(){var e=Object(j.a)(["\n  margin-left: 225px;\n"]);return G=function(){return e},e}function V(){var e=Object(j.a)(["\n  min-height: 100vh;\n"]);return V=function(){return e},e}var F=function(e){var t=e.children,n=e.history;return r.a.createElement(M,null,r.a.createElement(N,null),r.a.createElement(B,null,r.a.createElement(R,{history:n}),r.a.createElement(K,null,t)))},M=T.a.div(V()),B=T.a.div(G()),K=T.a.div(D()),z=n(365),Q=n(367),W=function(e){var t=e.handleSignUp,n=e.loading;return r.a.createElement(z.a,{style:{minWidth:"400px"},className:"login-form",onFinish:t},r.a.createElement(z.a.Item,{name:"name",rules:[{required:!0,message:"Please type your Name"}]},r.a.createElement(Q.a,{autoFocus:!0,placeholder:"Name"})),r.a.createElement(z.a.Item,{name:"email",rules:[{required:!0,message:"Please type your Email"},{type:"email",message:"The input is not valid E-mail"}]},r.a.createElement(Q.a,{placeholder:"Email"})),r.a.createElement(z.a.Item,{name:"password",rules:[{required:!0,message:"Please type your Password"},{min:6,message:"The Password must have at least 6 characters"}]},r.a.createElement(Q.a,{type:"password",placeholder:"Password"})),r.a.createElement(z.a.Item,null,r.a.createElement(C.a,{loading:n,type:"primary",htmlType:"submit"},"Register")),"Or ",r.a.createElement("a",{href:"/signin"},"Sign In now!"))};W.defaultProps={loading:!1};var J=n(368),Y=function(e,t,n){J.a[e]({message:t,description:n})};function $(){var e=Object(j.a)(["\n  h1 {\n    text-align: center;\n  }\n  .content {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n  width: 100%;\n  min-height: 100vh;\n  padding-top: 40px;\n"]);return $=function(){return e},e}var H=function(e){Object(k.a)(n,e);var t=Object(I.a)(n);function n(e){var a;return Object(x.a)(this,n),(a=t.call(this,e)).changeLoadingStatus=function(e){a.setState({loading:e})},a.handleSignUp=function(e){var t=a.props,n=t.signUp,r=t.history;a.state.loading||(a.changeLoadingStatus(!0),n(e).then((function(){a.changeLoadingStatus(!1),Y("success","Create Account","Account created successfully!"),r.push("/signin")})).catch((function(e){Y("error","Create Account",e.message||"Error to sign up"),a.changeLoadingStatus(!1)})))},a.state={loading:!1},a}return Object(_.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.logged,n=e.history;!0===t&&n.push("/")}},{key:"render",value:function(){var e=this.state.loading;return r.a.createElement(X,null,r.a.createElement("h1",null,"Register Account"),r.a.createElement("div",{className:"content"},r.a.createElement(W,{loading:e,handleSignUp:this.handleSignUp})))}}]),n}(a.Component),X=T.a.div($()),Z=Object(l.b)((function(e){return{logged:e.AppReducer.logged}}),(function(e){return{signUp:function(t){return e(function(e){return function(){return u.a.post("/auth/signup",e).then((function(e){return e.data})).catch((function(e){return Promise.reject(e.response.data)}))}}(t))}}}))(H),ee=function(e){var t=e.handleLogin;return r.a.createElement(z.a,{style:{minWidth:"400px"},name:"normal_login",className:"login-form",onFinish:t},r.a.createElement(z.a.Item,{name:"email",rules:[{required:!0,message:"Please type your Email"},{type:"email",message:"The input is not valid E-mail"}]},r.a.createElement(Q.a,{autoFocus:!0,placeholder:"Email"})),r.a.createElement(z.a.Item,{name:"password",rules:[{required:!0,message:"Please type your Password"}]},r.a.createElement(Q.a,{type:"password",placeholder:"Password"})),r.a.createElement(z.a.Item,null,r.a.createElement(C.a,{type:"primary",htmlType:"submit"},"Log in")),"Or ",r.a.createElement("a",{href:"/signup"},"register now!"))},te=n(100),ne=n(366),ae=function(e){var t=e.visible,n=e.handleCancel,a=e.handleOk,o=e.loading,i=z.a.useForm(),c=Object(te.a)(i,1)[0];return r.a.createElement(ne.a,{visible:t,title:"Two-Step Verification",onOk:function(){c.validateFields().then((function(e){a(e)})).catch((function(e){return e}))},confirmLoading:o,onCancel:n,okText:"Verify"},r.a.createElement(z.a,{form:c},r.a.createElement(z.a.Item,{name:"token",rules:[{required:!0,message:"Token is required"}],label:"Token"},r.a.createElement(Q.a,{autoComplete:"off",autoFocus:!0,placeholder:"Token code"}))))};function re(){var e=Object(j.a)(["\n  h1 {\n    text-align: center;\n  }\n  .content {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n  width: 100%;\n  min-height: 100vh;\n  padding-top: 40px;\n"]);return re=function(){return e},e}var oe=function(e){Object(k.a)(n,e);var t=Object(I.a)(n);function n(e){var a;return Object(x.a)(this,n),(a=t.call(this,e)).openTwoStepVerificationModal=function(){a.setState({twoStepModalShow:!0})},a.closeTwoStepVerificationModal=function(){a.setState({twoStepModalShow:!1})},a.showSignInSuccessNotification=function(){Y("success","Login","Signed in successfully")},a.changeLoadingStatus=function(e){a.setState({loading:e})},a.handleLogin=function(e){var t=a.state.loading,n=a.props,r=n.signIn,o=n.history,i=n.setAsLogged;t||(a.changeLoadingStatus(!0),r(e).then((function(e){var t=e.user,n=e.accessToken;t.twoAuthEnabled?(a.setState({accessToken:n}),a.openTwoStepVerificationModal(),a.changeLoadingStatus(!1)):(a.showSignInSuccessNotification(),i(n),o.push("/"))})).catch((function(){Y("error","Login","Invalid credentials"),a.changeLoadingStatus(!1)})))},a.handleTwoStepVerification=function(e){var t=a.props,n=t.validateTwoStepToken,r=t.history,o=t.setAsLogged,i=a.state,c=i.accessToken;i.loading||(a.changeLoadingStatus(!0),n(e.token,c).then((function(){Y("success","Two-Step Verification","Token Validated"),o(c),r.push("/")})).catch((function(e){Y("error","Two-Step Verification",e.message||"Error to validate Token"),a.changeLoadingStatus(!1)})))},a.state={twoStepModalShow:!1,accessToken:"",loading:!1},a}return Object(_.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.logged,n=e.history;!0===t&&n.push("/")}},{key:"render",value:function(){var e=this.state,t=e.twoStepModalShow,n=e.loading;return r.a.createElement(ie,null,r.a.createElement("h1",null,"Sign In"),r.a.createElement("div",{className:"content"},r.a.createElement(ee,{handleLogin:this.handleLogin})),r.a.createElement(ae,{loading:n,handleOk:this.handleTwoStepVerification,visible:t,handleCancel:this.closeTwoStepVerificationModal}))}}]),n}(a.Component),ie=T.a.div(re()),ce=function(){return function(e){return u.a.post("/two-factor/generate").then((function(t){var n=t.data.data;e(y("GENERATE_QR_SUCCESS",n))})).catch((function(e){return Promise.reject(e.response.data)}))}},le=Object(l.b)((function(e){var t=e.AppReducer;return{logged:t.logged,currentUser:t.currentUser}}),(function(e){return{signIn:function(t){return e((n=t,function(e){return u.a.post("/auth/signin",n).then((function(t){var n=t.data.data;return e(y("SIGN_IN_SUCCESSFULL",n.user)),n})).catch((function(e){return Promise.reject(e.response.data)}))}));var n},validateTwoStepToken:function(t,n){return e(function(e,t){return function(){return u.a.post("/two-factor/validate",{token:e},{headers:{Authorization:"Bearer ".concat(t)}}).then((function(){})).catch((function(e){return Promise.reject(e.response.data)}))}}(t,n))},setAsLogged:function(t){return e(function(e){return function(t){t(y("SET_LOGGED")),b(e)}}(t))}}}))(oe),se=function(e){var t=function(t){Object(k.a)(a,t);var n=Object(I.a)(a);function a(e){var t;return Object(x.a)(this,a),(t=n.call(this,e)).setStateToComponent=function(e){var n=e.logged,a=e.history;n?t.setState({canAccess:!0}):a.push("/signin")},t.state={canAccess:!1},t}return Object(_.a)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.logged,n=e.history;this.setStateToComponent({logged:t,history:n})}},{key:"render",value:function(){return this.state.canAccess&&r.a.createElement(e,null)}}]),a}(a.Component);return Object(l.b)((function(e){return{logged:e.AppReducer.logged}}))(Object(O.f)(t))};function ue(){var e=Object(j.a)(["\n  background-color: rgba(7, 71, 166, 0.6);\n  width: 30px;\n  height: 30px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #fff;\n  font-weight: 500;\n  margin-right: 10px;\n"]);return ue=function(){return e},e}function pe(){var e=Object(j.a)(["\n    margin: 20px 0;\n  .header {\n    display: flex;\n    align-items: center;\n    .step-title {\n      color: #172B4D;\n    }\n  }\n  .content {\n    padding: 10px 0 0 30px;\n  }\n"]);return pe=function(){return e},e}var de=function(e){var t=e.step,n=e.title,a=e.component;return r.a.createElement(me,null,r.a.createElement("div",{className:"header"},r.a.createElement(fe,null,r.a.createElement("span",null,t)),r.a.createElement("span",{className:"step-title"},n)),r.a.createElement("div",{className:"content"},a))};de.defaultProps={component:r.a.createElement("div",null)};var me=T.a.div(pe()),fe=T.a.div(ue());function ge(){var e=Object(j.a)(["\n  display: flex;\n  .instructions {\n    * { font-size: 14px !important; }\n    width: 450px;\n    padding-left: 20px;\n    padding-top: 20px;\n    .title {\n      margin-right: 5px;\n      color: #172B4D;\n      font-weight: 500;\n    }\n  }\n"]);return ge=function(){return e},e}var he=function(e){var t=e.qrImage,n=e.userEmail,a=e.secretKey;return t&&r.a.createElement(ve,null,r.a.createElement("img",{alt:"",src:t,width:"162",height:"162"}),r.a.createElement("div",{className:"instructions"},r.a.createElement("p",null,r.a.createElement("span",{className:"title"},"Can't scan the code?"),r.a.createElement("span",null,"You can add the code to your application manually using the following details:")),r.a.createElement("p",null,r.a.createElement("span",{className:"title"},"Account:"),r.a.createElement("span",null,n)),r.a.createElement("p",null,r.a.createElement("span",{className:"title"},"Key:"),r.a.createElement("span",null,a))))},ve=T.a.div(ge()),Ee=n(363),Se=n(364),be=function(e){var t=e.handleActivation,n=z.a.useForm(),a=Object(te.a)(n,1)[0];return r.a.createElement(Ee.a,null,r.a.createElement(Se.a,{span:6},r.a.createElement(z.a,{form:a,layout:"vertical",name:"form_in_modal",onFinish:t},r.a.createElement(z.a.Item,{name:"verificationToken",rules:[{required:!0,message:"Verification code is required"}]},r.a.createElement(Q.a,{autoFocus:!0,placeholder:"Verification code"})),r.a.createElement(z.a.Item,null,r.a.createElement(C.a,{type:"primary",htmlType:"submit"},"Enable two-step verification")))))},ye=function(e){var t=e.qrImage,n=e.handleActivation,a=e.userEmail,o=e.secretKey;return r.a.createElement("div",null,r.a.createElement(de,{step:"1",title:"Download a two-step verification app"}),r.a.createElement(de,{step:"2",title:"Scan this QR code with your verification app",component:r.a.createElement(he,{qrImage:t,userEmail:a,secretKey:o})}),r.a.createElement(de,{step:"3",title:"Enter the resulting verification code",component:r.a.createElement(be,{handleActivation:n})}))};function we(){var e=Object(j.a)(["\n  .title {\n    font-weight: 500;\n    font-size: 20px;\n    color: #172B4D;\n  }\n"]);return we=function(){return e},e}ye.defaultProps={qrImage:""};var Oe=function(e){Object(k.a)(n,e);var t=Object(I.a)(n);function n(e){var a;return Object(x.a)(this,n),(a=t.call(this,e)).changeLoadingStatus=function(e){a.setState({loading:e})},a.handleActivation=function(e){var t=e.verificationToken,n=a.props,r=n.activateTwoStep,o=n.signOut,i=n.history;r(t).then((function(){a.changeLoadingStatus(!1),Y("success","Enable Two-Step","Activation successfully, please re-login"),o(i)})).catch((function(e){Y("error","Enable Two-Step",e.message||"Error to activate two-step"),a.changeLoadingStatus(!1)}))},a.handleDeactivation=function(){(0,a.props.deactivateTwoStep)().then((function(){a.changeLoadingStatus(!1),Y("success","Disable Two-Step","Deactivation successfully")})).catch((function(e){Y("error","Disable Two-Step",e.message||"Error to disable two-step"),a.changeLoadingStatus(!1)}))},a.renderSteps=function(){var e=a.state.loading,t=a.props,n=t.qrImage,o=t.currentUser,i=t.secretKey;return o.twoAuthEnabled?r.a.createElement(C.a,{loading:e,onClick:a.handleDeactivation,type:"primary"},"Disable two-step verification"):r.a.createElement(ye,{userEmail:o.email,secretKey:i,loading:e,handleActivation:a.handleActivation,qrImage:n})},a.state={loading:!1},a}return Object(_.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.generateQR;e.currentUser.twoAuthEnabled||t()}},{key:"render",value:function(){var e=this.props.currentUser;return r.a.createElement(je,null,r.a.createElement("p",{className:"title"},"Two-Step Verification"),r.a.createElement("p",null,"Setting up two-step verification is easy, just follow the steps below."),r.a.createElement("p",null,"Name: ",e.name||""),this.renderSteps())}}]),n}(a.Component),je=T.a.div(we()),Te=Object(l.b)((function(e){var t=e.TwoStepReducer,n=t.qrImage,a=t.secretKey;return{qrImage:n,currentUser:e.AppReducer.currentUser,secretKey:a}}),(function(e){return{generateQR:function(){return e(ce())},activateTwoStep:function(e){return function(e){return u.a.post("/two-factor/activate",{token:e}).catch((function(e){return Promise.reject(e.response.data)}))}(e)},deactivateTwoStep:function(){return e((function(e){return u.a.post("/two-factor/deactivate").then((function(){return e(ce())})).then((function(){e(y("DISABLE_TWO_STEP"))})).catch((function(e){return Promise.reject(e.response.data)}))}))},signOut:function(t){return e(w(t))}}}))(Oe),xe=function(){return r.a.createElement("h2",null,"Pagina no encontrada")},_e=function(e){return r.a.createElement(F,e,r.a.createElement(O.c,null,r.a.createElement(O.a,{path:"/",component:Te}),r.a.createElement(O.a,{component:xe})))},ke=function(){return r.a.createElement(O.c,null,r.a.createElement(O.a,{path:"/signin",component:le}),r.a.createElement(O.a,{path:"/signup",component:Z}),r.a.createElement(O.a,{path:"/",component:se(Object(O.f)(_e))}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(360);u.a.defaults.baseURL="";var Ie=function(){i.a.render(r.a.createElement(l.a,{store:S},r.a.createElement(c.a,null,r.a.createElement(ke,null))),document.getElementById("root"))};i.a.render(r.a.createElement("h3",null,"loading..."),document.getElementById("root")),new Promise((function(e,t){var n=localStorage.getItem("_s");n?(b(n),u.a.post("/auth/check-session-token").then((function(t){var n=t.data.data;S.dispatch(y("SIGN_IN_SUCCESSFULL",n)),S.dispatch(y("SET_LOGGED")),e(t.data)})).catch((function(){localStorage.removeItem("_s"),t()}))):t()})).then(Ie).catch(Ie),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[190,1,2]]]);